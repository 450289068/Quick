<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-CN" navname="comment">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script type="text/javascript" src="Scripts/jquery-1.8.2.min.js"></script>
    <script type="text/javascript" src="Scripts/framework.js"></script>
    <script type="text/javascript" src="Scripts/chart.min.js"></script>
    <script type="text/javascript" src="js/bootstrap/js/bootstrap.js"></script>
    <link href="js/bootstrap/css/bootstrap.css" rel="stylesheet" type='text/css' />
    <link href="js/button/buttons.css" rel="stylesheet" />
    <title>Quick 评论</title>
</head>
<style>
    a:hover.button{
        color: #FFFFFF ! important ;
        text-decoration: none;
    }
    a:focus.button {
        color: #FFFFFF ! important ;
        text-decoration: none;
    }
</style>
<body class="background" style="padding-top: 50px;">
    <div class="container small-padding">
        <p><span class="lead">评价留言 </span></p>
        <div>
            <div class="input-group">
                <span class="input-group-addon"><span class="icon-user"></span></span>
                <input type="text" class="form-control" id="textName" placeholder="您的名字">
            </div>
            <br/>
            <p class="lead">您的评价、意见或建议：</p>
            <p>如果您觉得有某些快捷条目在Quick中不存在（如设定下划线颜色），请在此页面反馈，谢谢。</p>
            <div class="input-group">
                <span class="input-group-addon"><span class="icon-edit"></span></span>
                <textarea class="form-control" rows="5" id="textComment" placeholder="您的评价、意见或建议"></textarea>
            </div>
            <br/>
            <div class="right-align">
                <a id="anchor_submit" class="button button-primary" href="javascript:submitComment()"><i id="submit_comment" class="icon-share-alt"></i><span id="sp_submit"> 提交</span></a>
            </div>
        </div>
        <hr/>
        <p class="lead">最新留言：</p>
        <div id="comment_group">
        </div>
    </div>
    <div class="modal fade" id="modal_response" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="myModalLabel">提示：</h4>
                </div>
                <div class="modal-body">
                    <p><span id="svrMsgBack"></span><p>
                </div>
                <div class="modal-footer">
                    <a href="javascript:void(0)" class="button glow button-rounded button-flat-action" data-dismiss="modal">确定</a>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
    </body>
    <footer style="text-align: center; margin-top: 40px">
        <p>Automaton Framework</p>
        <p>于益偲</p>
        <p>2014年2月24日创建</p>
    </footer>

    <script type="text/javascript" src="Scripts/comment.js"></script>
    <script type="text/javascript">
    var commentsCount = 10;
    function submitComment(){
        var callback = function(){
                $('#submit_comment').attr('class', 'icon-share-alt');
                $('#anchor_submit').removeClass('btn-disabled');
                $('#sp_submit').html(' 提交');
                refresh();
            };
        if (!$('#anchor_submit').hasClass('btn-disabled')){
            $('#submit_comment').attr('class', 'icon-spinner icon-spin');
            $('#anchor_submit').addClass('class', 'btn-disabled');
            $('#sp_submit').html(' 提交中');
            var success = submit($('#textName').val(), $('#textComment').val(), 'modal_response', 'svrMsgBack', callback);
            if (success){
                $('#textName').val('');
                $('#textComment').val('');
            }
        }
    }

    function getcomment () {
        var commentCount = $.ajax({ url: 'api.aspx', data: { action: 'getspecificcount()' },
            success: function(){ getDetails(commentCount.responseText); },
            async: true
        });
    }

    function getDetails(count){
        if (count != "0" ) {
            var jsonRet = $.ajax({ url: 'api.aspx', data: { action: 'getcomment("' + commentsCount + '")' },
                success: function(){ 
                    $('#spin').hide();
                    var ret = eval('(' + jsonRet.responseText + ')');
                    for (var i=0; i<ret.comments.length; i++){
                        createCommentViewer('comment_group', i);
                        $('#comment_name_' + i).text('姓名：' + ret.comments[i].name);
                        $('#comment_content_' + i).text(ret.comments[i].content);
                        $('#comment_date_' + i).text('留言日期：' + ret.comments[i].date);
                    }
                },
                async: true
            });
        } else {
            $('#comment_group').prepend('暂无留言');
            $('#spin').hide();
        }
    };

    function refresh(){
        $('#comment_group').empty();
        $('#comment_group').prepend('<div id="spin" style="text-align: center"> <i class="icon-spinner icon-spin"></i> </div>');
        getcomment();
    }

    $(document).ready( function () {
        refresh();
    } );

    </script>
</body>

</html>
